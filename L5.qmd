---
title: "Resolu√ß√£o da 5¬™ Lista de MATD64"
author: "Fernando Bispo"
format: 
    html:
      toc: true
      toc-location: right
      toc-title: √çndice
      toc-depth: 4
      code-fold: true
      code-summary: "Mostrar C√≥digo"
      code-overflow: wrap
      code-tools:
        source: false
        toggle: true
      code-block-bg: true
      code-block-border-left: "#31BAE9"
      code-copy: true
---

```{r pacotes&dados}
#| echo: false
#| warning: false


if(!require("pacman"))install.packages("pacman")

pacman::p_load(DT)

library("qcc")

parafusos <- readxl::read_xls('parafusos.xls')
```


## Apresenta√ß√£o

Resolu√ß√£o da Lista 5.

## Exerc√≠cio 1

Em uma f√°brica de sapatos, 200 pares s√£o analisados diariamente. Nos 25 dias √∫teis de um m√™s
foram registrados os n√∫meros de pares defeituosos mostrados na tabela abaixo.


a) Estabele√ßa um gr√°fico de controle para monitorar a produ√ß√£o futura. Considere ùëù = 0,05.
b) Qual o menor tamanho de amostra que pode ser usado para esse processo e ainda fornecer um
limite inferior de controle positivo para o gr√°fico?

### Solu√ß√£o

::: {.panel-tabset}
#### Item a

Tendo em vista o cen√°rio inicial, aquele em que n√£o se remove nenhuma informa√ß√£o a fim de avaliar o comportamento dos dados quanto aos limites de controle, se construiu a Figura 1.


```{r item 1a_1}
#| code-fold: true
#| warning: false
#| fig-align: center
#| fig-width: 9
#| fig-height: 6
#| error: false
#| message: false

x = c(9, 11, 14, 9, 16, 11, 10, 12, 5, 10, 9, 11, 7, 9, 22, 11, 8, 11, 9, 13, 9, 7, 9, 8, 12)
p = 0.05

qcc::qcc(x, type = "p", sizes = 200, plot = F, center = p)|>
  plot(label.limits = c("LIC", "LSC"), xlab = "Amostras",
       ylab = "Resumo das Estat√≠sticas das Amostras",
       title = "Figura 1: Gr√°fico das propor√ß√µes de itens defeituosos")

```


√â poss√≠vel constatar, na Figura 1, a quebra do limite superior na amostra de n√∫mero 15, para o cumprimento dos requisitos da quest√£o, se removeu a informa√ß√£o que gerou o erro a fim de se avaliar o comportamento do processo sem a informa√ß√£o que gerou o erro, sendo retratado na Figura 2.


```{r item 1a_2}
#| warning: false
#| fig-align: center
#| fig-width: 9
#| fig-height: 6
#| error: false
#| message: false

qcc::qcc(x[-15], type = "p", sizes = 200, plot = F, center = p)|>
  plot(label.limits = c("LIC", "LSC"), xlab = "Amostras",
       ylab = "Resumo das Estat√≠sticas das Amostras",
       title = "Figura 2: Gr√°fico das propor√ß√µes de itens defeituosos sem a \ninforma√ß√£o discrepante")
```


Ap√≥s a remo√ß√£o da informa√ß√£o discrepante, o processo permaneceu sob controle, sendo este o gr√°fico adequado para o monitoramento da produ√ß√£o futura.


#### Item b

<!-- Para a obtens√£o do menor tamanho de amostra se faz necess√°rio a utiliza√ß√£o da f√≥rmula do LIC: -->


O que se deseja √© obter um valor m√≠nimo de $n$ (tamanho da amostra) tal que $LIC > 0$

$$
LIC = p + 3\sqrt{ \dfrac{p(1-p)}{n}} > 0
$$

Substituindo $p = 0,05$ e realizando os algebrismos necess√°rios, tem-se:

$$
LIC = 0,05 + 3 \times \sqrt{ \dfrac{0,05(0,95)}{n}} = 0 \Rightarrow \Bigg(\dfrac{-0,05}{3}\Bigg)^2 = \dfrac{0,0475}{n} \Rightarrow
$$

$$
\Rightarrow n = \dfrac{0,0475}{\Bigg(\dfrac{-0,05}{3}\Bigg)^2} \therefore n = 171
$$




Baseado no valor de $n$ tal que $LIC = 0$, conclui-se que $n = 172$  satisfaz o requisito solicitado.

<!-- Com base na f√≥rmula, o valor m√≠nimo de $n$ necess√°rio √© $172$. -->
<!-- Ap√≥s as devidas manipula√ß√µes alg√©bricas, a obtens√£o do menor tamanho √© atrav√©s da seguinte express√£o: -->


<!-- $$ -->
<!-- n = \frac{p(1-p)}{\bigg(\dfrac{p - LIC}{3}\bigg)^2} -->
<!-- $$ -->
:::

## Exerc√≠cio 2

(Montgomery, 2013) A maintenance group improves the effectiveness of its repair work by
monitoring the number of maintenance requests that require a second call to complete the repair.
Twenty weeks of data are shown in the table below.

a) Find trial control limits for this process.
b) Design a control chart for controlling future production.
c) Analyze these data using an average sample size.
d) Construct a standardized control chart for these data.

**Tradu√ß√£o**\   
(Montgomery, 2013) Um grupo de manuten√ß√£o melhora a efic√°cia de seu trabalho de reparo monitorando o n√∫mero de solicita√ß√µes de manuten√ß√£o que requerem uma segunda chamada para concluir o reparo.\    
Vinte semanas de dados s√£o mostradas na tabela abaixo.

a) Encontre os limites de controle de tentativa para este processo.
b) Projete um gr√°fico de controle para controlar a produ√ß√£o futura.
c) Analise esses dados usando um tamanho de amostra m√©dio.
d) Construa um gr√°fico de controle padronizado para esses dados.

### Solu√ß√£o

::: {.panel-tabset}

#### Item a


```{r q2a}
#| warning: false

m = 20

n = c(200, rep(250, 3), 200, 200, rep(150, 4), rep(100, 3), rep(200, 5), rep(250, 2))

segunda_vis = c(6, 8, 9, 7, 3, 4, 2, 1, 0, 2, 1, 0, 1, 4, 5, 3, 10, 4, 7, 6)

p_hat_i = segunda_vis/n

p_barra = sum(segunda_vis)/sum(n)

LSC = p_barra + 3*sqrt((p_barra*(1 - p_barra))/n)
LIC = p_barra - 3*sqrt((p_barra*(1 - p_barra))/n)

```


Em virtude de ter-se tamanhos desiguais do n¬∞ de solicita√ß√µes de manuten√ß√£o √© necess√°rio a utiliza√ß√£o das m√©dias ponderadas para obten√ß√£o da estimativa.

$\bar{p} = \dfrac{\sum_{i = 1}^{m}{d}_i}{\sum_{i = 1}^{m}{n}_i} \approx$ `r scales::number(p_barra, accuracy = 0.0001, big.mark = ".", decimal.mark = ",")`

De posse da propor√ß√£o m√©dia de segundas visitas, calcula-se os limites:

$LSC \approx$ `r scales::number(LSC, accuracy = 0.0001, big.mark = ".", decimal.mark = ",")`   

$LIC \approx$ `r scales::number(LIC, accuracy = 0.0001, big.mark = ".", decimal.mark = ",")`


#### Item b

```{r q2b}
#| code-fold: true
#| warning: false
#| fig-align: center
#| fig-width: 9
#| fig-height: 6
#| error: false
#| message: false

qcc::qcc(segunda_vis, type = "p", sizes = n, plot = F)|>
  plot(label.limits = c("LIC", "LSC"), xlab = "Amostras",
       ylab = "Resumo das Estat√≠sticas das Amostras",
       title = "Figura 3: Gr√°fico das propor√ß√µes de manuten√ß√µes \nque requerem segunda visita para conclus√£o")

```


#### Item c


```{r q2c}
#| warning: false
#| fig-align: center
#| fig-width: 9
#| fig-height: 6
#| error: false
#| message: false

qcc::qcc(segunda_vis, type = "p", sizes = mean(n), plot = F)|>
  plot(label.limits = c("LIC", "LSC"), xlab = "Amostras",
       ylab = "Resumo das Estat√≠sticas das Amostras",
       title = "Figura 4: Gr√°fico da m√©dia das amostras das propor√ß√µes de manuten√ß√µes \nque requerem segunda visita para conclus√£o")

```


Analisando a Figura 4 com base nas **regras sensibilizantes** se constata a exist√™ncia de 10 pontos consegutivos abaixo da linha central, caracterizando uma **mudan√ßa** na m√©dia do processo.


#### Item d

```{r}
#| warning: false
#| fig-align: center
#| fig-width: 9
#| error: false
#| message: false


pse=function(m,n,y) {
  if (length(n)==1){
    p=sum(y)/(n*m);LIC=p-3*sqrt(p*(1-p)/n); if (LIC<0) LIC=0
    LSC=p+3*sqrt(p*(1-p)/n)	
    time=cbind(seq(1,m),seq(1,m),seq(1,m),seq(1,m))
    w=cbind(y/n,rep(p,m),rep(LIC,m),rep(LSC,m))
    par(mfrow=c(1,1))
    matplot(time,w,type="o",pch=20,main="Gr√°fico p",
            col=c("black","blue","red","red"),ylab="p",
            xlab="Amostras", ylim=c(min(w),max(w)),lty=1,lwd=2)
  } else {
    p=sum(y)/sum(n);LIC=numeric(m);LSC=numeric(m);z=numeric(m)
    for (i in 1:m){
      LIC[i]=p-3*sqrt(p*(1-p)/n[i]); if (LIC[i]<0) LIC[i]=0
      LSC[i]=p+3*sqrt(p*(1-p)/n[i])	
      z[i]=((y[i]/n[i]-p)/sqrt(p*(1-p)/n[i]))
    }
    time=cbind(seq(1,m),seq(1,m),seq(1,m),seq(1,m))
    w1=cbind(y/n,rep(p,m),LIC,LSC)
    w2=cbind(z,rep(0,m),rep(-3,m),rep(3,m))
    # par(mfrow=c(1,2))
    # matplot(time,w1,type="o",pch=20,ylim=c(min(w1),max(w1)),
    #         col=c("black","blue","red","red"),lty=1,lwd=2,
    #         main="Gr√°fico p",ylab="p",xlab="Amostras"	)
    matplot(time,w2,type="o",pch=20,ylim=c(min(w2),max(w2)),
            col=c("black","blue","red","red"),xlab="Amostras",
            main="Gr√°fico p Padronizado",ylab="z",lty=1,lwd=2)
  }
}

pse(m, n, segunda_vis)

```



:::

## Exerc√≠cio 3

Num grande hotel, diariamente inspecionam-se 30 quartos quanto a falhas em sua arruma√ß√£o.
S√£o apresentados os resultados (contagem de erros na arruma√ß√£o de quartos) do acompanhamento ao longo de 30 dias.

a) Construa um gr√°fico do n√∫mero de defeitos na amostra.
b) Fa√ßa uma an√°lise e interpreta√ß√£o da estabilidade do processo.

### Solu√ß√£o

::: {.panel-tabset}
#### Item a






#### Item b


::::

## Exerc√≠cio 4

(Adapted from Montgomery, 2013) The data in the table below are the number of information errors found in customer records in a marketing company database. Five records were sampled each day.

a) Set up a c chart for the total number of errors. Is the process in control?
b) Set up a Bell-c chart for the total number of errors. Is the process in control?
c) Discuss the findings from parts (a) and (b). Is the Poisson distribution a good model for these
data? Is there evidence of this in the data?


**Tradu√ß√£o**

(Adaptado de Montgomery, 2013) Os dados da tabela abaixo s√£o o n√∫mero de erros de informa√ß√£o encontrados em registros de clientes em um banco de dados de uma empresa de marketing. Cinco registros foram amostrados a cada dia.


```{r tab4}
#| warning: false
#| fig-align: center
#| fig-width: 9
#| error: false
#| message: false

dia = c(1:25)

reg1 = c(8, 11, 1, 3, 3, 6, 8, 4, 1, 15, 1, 6, 7, 2, 6, 2, 11, 5, 6, 2, 7, 4, 4, 15, 2)
reg2 = c(7, 1, 1, 2, 2, 3, 8, 10, 6, 1, 7, 7, 6, 9, 14, 9, 1, 5, 15, 7, 5, 3, 1, 2, 15)
reg3 = c(1, 11, 8, 5, 13, 3, 2, 2, 1, 3, 13, 9, 3, 3, 7, 4, 1, 19, 5, 9, 6, 8, 4, 7, 3)
reg4 = c(11, 2, 2, 1, 6, 3, 1, 6, 3, 2, 5, 3, 3, 8, 1, 2, 3, 1, 6, 2, 14, 1, 20, 10, 11)
reg5 = c(17, 9, 5, 4, 5, 1, 5, 4, 2, 8, 1, 1, 1, 7, 8, 1, 2, 3, 6, 8, 10, 2, 5, 17, 2)

registros = cbind(dia, reg1, reg2, reg3, reg4, reg5)|> 
  tibble::as_tibble()

head(registros)|>
  DT::datatable(
    caption = "Tabela 4: N¬∞ de erros em registros de clientes.",
    colnames = c("Dia", "Registro 1", "Registro 2", "Registro 3", "Registro 4", "Registro 5"),
    extensions = 'FixedHeader', 
    rownames = F,
    # container = tit,
    options = list(
      dom = 't',
      # fixedHeader = F, 
      autoWidth = F,
      columnDefs =
        list(
          list(className = 'dt-center', targets = c(0:5)))))

```

\   
a) Monte um gr√°fico c para o n√∫mero total de erros. O processo est√° sob controle?
b) Monte um gr√°fico Bell-c para o n√∫mero total de erros. O processo est√° sob controle?
c) Discuta as conclus√µes das partes (a) e (b). A distribui√ß√£o de Poisson √© um bom modelo para esses dados? H√° evid√™ncias disso nos dados?



### Solu√ß√£o

::: {.panel-tabset}

#### Item a

```{r fig8}
#| code-fold: true
#| warning: false
#| fig-align: center
#| fig-width: 9
#| fig-height: 6
#| error: false
#| message: false

registros = registros|>
  dplyr::mutate(
    total = rowSums(registros[,-1])
  )

qcc::qcc(registros$total, type = "c", plot = F)|>
  plot(label.limits = c("LIC", "LSC"), xlab = "Amostras",
       ylab = "Resumo das Estat√≠sticas das Amostras",
       title = "Figura 8: Gr√°fico do total de erros em registros de clientes")


```


Conforme exposto na Figura 8 √© poss√≠vel constatar que o processo n√£o est√° sob controle, para tanto foram removidos os totais de observa√ß√µes dos dias 1, 21 e 24 respectivamente (Figura 9), sendo necess√°rio uma an√°lise mais aprofundada para identificar causas de descontrole nos dias identificados.


```{r fig9}
#| code-fold: true
#| warning: false
#| fig-align: center
#| fig-width: 9
#| fig-height: 6
#| error: false
#| message: false

qcc::qcc(registros$total[-c(1, 21, 24)], type = "c", plot = F)|>
  plot(label.limits = c("LIC", "LSC"), xlab = "Amostras",
       ylab = "Resumo das Estat√≠sticas das Amostras",
       title = "Figura 9: Gr√°fico do total de erros em registros de clientes sem pontos de descontrole")

```



#### Item b









#### Item c









:::


## Exerc√≠cio 5


### Solu√ß√£o



